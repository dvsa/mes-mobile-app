<ion-header>
  <ion-navbar>
    <ion-title>Declaration - {{pageState.candidateUntitledName$ | async}}</ion-title>
    <ion-buttons end>
      <end-test-link></end-test-link>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content no-bounce>
  <lock-screen-indicator></lock-screen-indicator>
  <div>
    <form [formGroup]="form">
      <candidate-section [candidateName]="pageState.candidateName$ | async"
        [candidateDriverNumber]="pageState.candidateDriverNumber$ | async" (continueClickEvent)="onSubmit()">
      </candidate-section>
      <div class="mes-full-width-card-separator"></div>
      <div class="mes-full-width-card" id="declaration-section">

        <ion-row class="mes-validated-row">
          <ion-col>
            <div class="communication-text-container">
              <h4>Select how to receive the test results</h4>
            </div>
            <div class="validation-bar"></div>
            <ion-col align-self-center>

              <provided-email [formGroup]="form" [shouldRender]="pageState.candidateProvidedEmail$ | async"
                [providedEmailAddress]="pageState.candidateProvidedEmail$ | async"
                [providedEmailAddressChosen]="isProvidedEmailSelected()" [providedEmailRadioValue]="selectProvidedEmail"
                (providedEmailRadioSelect)="dispatchCandidateChoseProvidedEmail()">
              </provided-email>

              <new-email [formGroup]="form" [newEmailAddress]="pageState.communicationEmail$ | async"
                [newEmailAddressChosen]="isNewEmailSelected()" [newEmailRadioValue]="selectNewEmail"
                (newEmailRadioSelect)="setCommunicationType('Email', 'Updated')"
                (newEmailTextChange)="dispatchCandidateChoseNewEmail($event)">
              </new-email>

              <postal-address [formGroup]="form" [postalAddress]="pageState.candidateAddress$ | async"
                [isPostalAddressChosen]="isPostSelected()" (postalRadioSelect)="dispatchCandidateChosePost($event)">
              </postal-address>

              <ion-row class="communication-option">
                <div class="validation-bar communication-validation-bar" [class.ng-invalid]="invalid"></div>
                <input type="radio" id="support-centre" class="gds-radio-button" formControlName="radioCtrl"
                  name="radioCtrl" (click)="setCommunicationType('Support Centre')" [value]="isSupportCentreSelected()"
                  [checked]="isSupportCentreSelected()">
                <label for="support-centre" class="radio-label">By calling the support centre</label>
              </ion-row>

              <ion-row class="validation-message-row" align-items-center>
                <div class="validation-text"></div>
              </ion-row>
              </ion-col>
            </ion-col>
        </ion-row>
      </div>
    </form>
  </div>
</ion-content>