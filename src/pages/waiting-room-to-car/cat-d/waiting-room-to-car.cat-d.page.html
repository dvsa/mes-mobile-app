<ion-header>
  <ion-navbar [hideBackButton]="!(pageState.delegatedTest$ | async)">
    <ion-title>{{pageState.candidateName$ | async}}</ion-title>
    <ion-buttons end>
      <end-test-link [shouldAuthenticate]="false" category="D"></end-test-link>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content>
  <div>
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <ion-grid>
        <ion-row no-padding id="post-eyesight-form-content">
          <ion-col no-padding>

            <candidate-declaration-signed
                    *ngIf="pageState.delegatedTest$ | async"
                    [formGroup]="form"
                    [candidateSigned]="pageState.candidateDeclarationSigned$ | async"
                    [declarationSelected]="(pageState.insuranceDeclarationAccepted$ | async) && (pageState.residencyDeclarationAccepted$ | async)"
                    (candidateDeclarationChange)="candidateDeclarationOutcomeChanged($event)">
            </candidate-declaration-signed>

            <vehicle-registration [formGroup]="form" [vehicleRegistration]="pageState.registrationNumber$ | async"
              (vehicleRegistrationChange)="vehicleRegistrationChanged($event)"></vehicle-registration>

            <vehicle-checks-cat-d
                    *ngIf="!(pageState.delegatedTest$ | async)"
                    [formGroup]="form"
                    [vehicleChecksScore]="pageState.vehicleChecksScore$ | async"
                    [safetyQuestionsScore]="pageState.safetyQuestionsScore$ | async"
                    [vehicleChecks]="pageState.vehicleChecks$ | async"
                    [safetyQuestions]="pageState.safetyQuestions$ | async"
                    [onCloseVehicleChecksModal]="closeVehicleChecksModal"
            ></vehicle-checks-cat-d>

            <vehicle-checks-completed
                    *ngIf="pageState.delegatedTest$ | async"
                    [formGroup]="form"
                    [vehicleChecksCompleted]="pageState.vehicleChecksCompleted$ | async"
                    (vehicleChecksCompletedOutcomeChange)="vehicleChecksCompletedOutcomeChanged($event)"
            ></vehicle-checks-completed>

            <accompaniment-card [formGroup]="form" [instructorAccompaniment]="pageState.instructorAccompaniment$ | async"
              [supervisorAccompaniment]="pageState.supervisorAccompaniment$ | async" [otherAccompaniment]="pageState.otherAccompaniment$ | async"
              [interpreterAccompaniment]="pageState.interpreterAccompaniment$ | async" (instructorAccompanimentChange)="instructorAccompanimentToggled()"
              (supervisorAccompanimentChange)="supervisorAccompanimentToggled()" (otherAccompanimentChange)="otherAccompanimentToggled()"
              (interpreterAccompanimentChange)="interpreterAccompanimentToggled()">
            </accompaniment-card>
          </ion-col>
        </ion-row>

        <div *ngIf="!(pageState.delegatedTest$ | async)">
          <warning-banner *ngIf="displayLoadSecured() " warningText="Is the load secure?"></warning-banner>
        </div>

      </ion-grid>
    </form>
  </div>
</ion-content>
<ion-footer>
  <ion-row class="mes-full-width-card box-shadow">
    <button type="submit" class="mes-primary-button" id="continue-to-test-report-button" ion-button (click)="onSubmit()">
      <h3>Continue to test report</h3>
    </button>
  </ion-row>
</ion-footer>
