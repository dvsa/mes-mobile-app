<ion-header>
  <ion-navbar hideBackButton>
    <ion-title>{{pageState.candidateName$ | async}}</ion-title>
    <ion-buttons end>
      <end-test-link></end-test-link>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content no-bounce>
  <div>
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <ion-grid>

        <ion-row class="mes-validated-row mes-row-separator" id="eyesight-test-card">
          <div class="validation-bar" [class.ng-invalid]="isCtrlDirtyAndInvalid('eyesightCtrl')"></div>
          <ion-col class="component-label" col-32 align-self-center>
            <label>Eyesight test</label>
          </ion-col>
          <ion-col align-self-center>
            <ion-row class="spacing-row"></ion-row>
            <ion-row>
              <ion-col col-32>
                <input type="radio" formControlName="eyesightCtrl" name="eyesightCtrl" id="eyesight-pass"
                  class="gds-radio-button" [class.ng-invalid]="isCtrlDirtyAndInvalid('eyesightCtrl')"
                  (click)="eyesightPassPressed()" [checked]="pageState.eyesightPassRadioChecked$ | async" value="P">
                <label for="eyesight-pass" class="radio-label">Pass</label>
              </ion-col>
              <ion-col col-32>
                <input type="radio" formControlName="eyesightCtrl" name="eyesightCtrl" id="eyesight-fail"
                  class="gds-radio-button" [class.ng-invalid]="isCtrlDirtyAndInvalid('eyesightCtrl')"
                  (click)="eyesightFailPressed()" [checked]="pageState.eyesightFailRadioChecked$ | async" value="F">
                <label for="eyesight-fail" class="radio-label">Fail</label>
              </ion-col>
            </ion-row>
            <ion-row class="validation-message-row" align-items-center>
              <div class="validation-text" [class.ng-invalid]="isCtrlDirtyAndInvalid('eyesightCtrl')">
                Select the eyesight test outcome
              </div>
            </ion-row>
          </ion-col>
        </ion-row>

        <ion-row *ngIf="pageState.eyesightFailRadioChecked$ | async">
          <eyesight-failure-confirmation [cancelFn]="eyesightFailCancelled"></eyesight-failure-confirmation>
        </ion-row>

        <ion-row no-padding [hidden]="pageState.eyesightFailRadioChecked$ | async" id="post-eyesight-form-content">
          <ion-col no-padding>
            <tell-me-question-card [formGroup]="form" 
            [tellMeQuestion]="pageState.tellMeQuestion$ | async"
            [tellMeQuestions]="tellMeQuestions"
            [tellMeQuestionOutcome]="pageState.tellMeQuestionOutcome$ | async"
            [tellMeQuestionSelected]="pageState.tellMeQuestionSelected$ | async" 
            (tellMeQuestionChange)="tellMeQuestionChanged($event)"
            (tellMeQuestionOutcomeChange)="tellMeQuestionOutcomeChanged($event)">
          </tell-me-question-card>
        
            <vehicle-registration [formGroup]="form" [vehicleRegistration]="pageState.registrationNumber$ | async"
            (vehicleRegistrationChange)="vehicleRegistrationChanged($event)"></vehicle-registration>

            <transmission [formGroup]="form" [transmission]="pageState.transmission$ | async" (transmissionChange)="transmissionChanged($event)"></transmission>

            <instructor-registration [formGroup]="form" [instructorRegistration]="pageState.instructorRegistrationNumber$ | async"
            (instructorRegistrationChange)="instructorRegistrationChanged($event)"></instructor-registration>

            <accompaniment-card [formGroup]="form"
                [instructorAccompaniment]="pageState.instructorAccompaniment$ | async"
                [supervisorAccompaniment]="pageState.supervisorAccompaniment$ | async"
                [otherAccompaniment]="pageState.otherAccompaniment$ | async"
                (instructorAccompanimentChange)="instructorAccompanimentToggled()"
                (supervisorAccompanimentChange)="supervisorAccompanimentToggled()"
                (otherAccompanimentChange)="otherAccompanimentToggled()"></accompaniment-card>

            <vehicle-details-card [formGroup]="form"
                [schoolVehicleDetails]="pageState.schoolCar$ | async"
                [dualVehicleDetails]="pageState.dualControls$ | async"
                (schoolVehicleDetailsChange)="schoolCarToggled()"
                (dualVehicleDetailsChange)="dualControlsToggled()"></vehicle-details-card>
          </ion-col>
        </ion-row>

      </ion-grid>
      <ion-footer [hidden]="pageState.eyesightFailRadioChecked$ | async">
        <ion-row class="mes-full-width-card">
          <button type="submit" class="mes-primary-button" ion-button>
            <h3>Continue to test report</h3>
          </button>
        </ion-row>
      </ion-footer>
    </form>
  </div>
</ion-content>
